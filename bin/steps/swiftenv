# Activate swiftenv
puts-step Installing swiftenv

export SWIFTENV_ROOT="$CACHE_DIR/$STACK/swiftenv"
export PATH="$ROOT_DIR/swiftenv/bin:$PATH"
eval "$(swiftenv init -)"

if [ -f "$BUILD_DIR/.swift-version" ]; then
    export SWIFT_VERSION=`cat $BUILD_DIR/.swift-version | tr -d '[[:space:]]'`
else 
    export SWIFT_VERSION="$DEFAULT_SWIFT_VERSION"
fi

# Install Mongo driver
puts-step "Installing libmongoc"
sudo apt-get install pkg-config libssl-dev libsasl2-dev
wget https://github.com/mongodb/mongo-c-driver/releases/download/1.9.2/mongo-c-driver-1.9.2.tar.gz
tar xzf mongo-c-driver-1.9.2.tar.gz
cd mongo-c-driver-1.9.2
./configure --disable-automatic-init-and-cleanup
make
sudo make install
cd ..

# Install Swift
puts-step Installing Swift $SWIFT_VERSION
swiftenv install $SWIFT_VERSION -s
